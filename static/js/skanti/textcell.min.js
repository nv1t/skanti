var skanti=(function(a){var d=function(f){this.code_mirror_mode=this.code_mirror_mode||"htmlmixed";this.placeholder=this.placeholder||"\u0000";a.Cell.apply(this,arguments);this.rendered=false;this.cell_type=this.cell_type||"text"};d.prototype=new a.Cell();d.prototype.create_element=function(){var f=$("<div>").addClass("cell text_cell border-box-sizing");f.attr("tabindex","2");var g=$("<div/>").addClass("text_cell_input");this.code_mirror=CodeMirror(g.get(0),{indentUnit:4,mode:this.code_mirror_mode,theme:"default",value:this.placeholder,readOnly:this.read_only});var h=$("<div/>").addClass("text_cell_render").addClass("rendered_html").attr("tabindex","-1");f.append(g).append(h);this.element=f};d.prototype.bind_events=function(){a.Cell.prototype.bind_events.apply(this);var f=this;this.element.keydown(function(g){if(g.which===13){if(f.rendered){f.edit();g.preventDefault()}}})};d.prototype.select=function(){a.Cell.prototype.select.apply(this);var f=this.element.find("div.text_cell_render");f.trigger("focus")};d.prototype.edit=function(){if(this.read_only){return}if(this.rendered===true){var g=this.element;var f=g.find("div.text_cell_render");f.hide();g.find("div.text_cell_input").show();this.code_mirror.focus();this.code_mirror.refresh();this.rendered=false;if(this.get_source()===this.placeholder){this.set_source("")}}};d.prototype.render=function(){};d.prototype.config_mathjax=function(){var g=this.element;var f=this;g.click(function(){f.edit()}).focusout(function(){f.render()});g.trigger("focusout")};d.prototype.get_source=function(){return this.code_mirror.getValue()};d.prototype.set_source=function(f){this.code_mirror.setValue(f);this.code_mirror.refresh()};d.prototype.get_rendered=function(){return this.element.find("div.text_cell_render").html()};d.prototype.set_rendered=function(f){this.element.find("div.text_cell_render").html(f)};d.prototype.at_top=function(){if(this.rendered){return true}else{return false}};d.prototype.at_bottom=function(){if(this.rendered){return true}else{return false}};d.prototype.fromJSON=function(f){if(f.cell_type===this.cell_type){if(f.source!==undefined){this.set_source(f.source);this.set_rendered(f.rendered||"");this.rendered=false;this.render()}}};d.prototype.toJSON=function(){var f={};f.cell_type=this.cell_type;f.source=this.get_source();return f};var e=function(f){this.placeholder="\u0000Type <strong>HTML</strong> and LaTeX: $\\alpha^2$";a.TextCell.apply(this,arguments);this.cell_type="html"};e.prototype=new d();e.prototype.render=function(){if(this.rendered===false){var f=this.get_source();if(f===""){f=this.placeholder}this.set_rendered(f);this.typeset();this.element.find("div.text_cell_input").hide();this.element.find("div.text_cell_render").show();this.rendered=true}};var b=function(f){this.placeholder="\u0000Type *Markdown* and LaTeX: $\\alpha^2$";a.TextCell.apply(this,arguments);this.cell_type="markdown"};b.prototype=new d();b.prototype.render=function(){if(this.rendered===false){var h=this.get_source();if(h===""){h=this.placeholder}var g=a.markdown_converter.makeHtml(h);this.set_rendered(g);this.typeset();this.element.find("div.text_cell_input").hide();this.element.find("div.text_cell_render").show();var f=this.element.find("pre > code");f.replaceWith(function(){var i=$(this).html();i=i.replace(/(\r\n|\n|\r)/gm,"<br/>");i=i.replace(/ /gm,"&nbsp;");i=prettyPrintOne(i);return'<code class="prettyprint">'+i+"</code>"});this.rendered=true}};var c=function(f){this.placeholder="\u0000Type *ReStructured Text* and LaTeX: $\\alpha^2$";a.TextCell.apply(this,arguments);this.cell_type="rst"};c.prototype=new d();c.prototype.render=function(){if(this.rendered===false){var g=this.get_source();if(g===""){g=this.placeholder}var f={processData:false,cache:false,type:"POST",data:g,headers:{"Content-Type":"application/x-rst"},success:$.proxy(this.handle_render,this)};$.ajax("/rstservice/render",f);this.element.find("div.text_cell_input").hide();this.element.find("div.text_cell_render").show();this.set_rendered("Rendering...")}};c.prototype.handle_render=function(g,f,h){this.set_rendered(g);this.typeset();this.rendered=true};a.TextCell=d;a.HTMLCell=e;a.MarkdownCell=b;a.RSTCell=c;return a}(skanti));