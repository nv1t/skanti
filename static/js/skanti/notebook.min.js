var skanti=(function(b){var a=b.utils;var c=function(d){this.read_only=b.read_only;this.element=$(d);this.element.scroll();this.element.data("notebook",this);this.next_prompt_number=1;this.dirty=false;this.msg_cell_map={};this.metadata={};this.control_key_active=false;this.style();this.create_elements();this.bind_events();this.set_tooltipontab(true);this.set_smartcompleter(true);this.set_timebeforetooltip(1200)};c.prototype.style=function(){$("div#notebook").addClass("border-box-sizing")};c.prototype.create_elements=function(){var d=this;var e=$('<div class="end_space"></div>').height("30%");e.dblclick(function(g){if(d.read_only){return}var f=d.ncells();d.insert_code_cell_below(f-1)});this.element.append(e);$("div#notebook").addClass("border-box-sizing")};c.prototype.bind_events=function(){var d=this;$(document).keydown(function(f){if(d.read_only){return true}if(f.which===27){f.preventDefault()}if(f.which===38&&!f.shiftKey){var e=d.selected_cell();if(e.at_top()){f.preventDefault();d.select_prev()}}else{if(f.which===40&&!f.shiftKey){var e=d.selected_cell();if(e.at_bottom()){f.preventDefault();d.select_next()}}else{if(f.which===13&&f.shiftKey){d.execute_selected_cell();return false}else{if(f.which===13&&f.ctrlKey){d.execute_selected_cell({terminal:true});return false}else{if(f.which===77&&f.ctrlKey){d.control_key_active=true;return false}else{if(f.which===68&&d.control_key_active){d.delete_cell();d.control_key_active=false;return false}else{if(f.which===65&&d.control_key_active){d.insert_code_cell_above();d.control_key_active=false;return false}else{if(f.which===66&&d.control_key_active){d.insert_code_cell_below();d.control_key_active=false;return false}else{if(f.which===67&&d.control_key_active){d.to_code();d.control_key_active=false;return false}else{if(f.which===77&&d.control_key_active){d.to_markdown();d.control_key_active=false;return false}else{if(f.which===84&&d.control_key_active){d.toggle_output();d.control_key_active=false;return false}else{if(f.which===74&&d.control_key_active){d.move_cell_down();d.control_key_active=false;return false}else{if(f.which===75&&d.control_key_active){d.move_cell_up();d.control_key_active=false;return false}else{if(f.which===80&&d.control_key_active){d.select_prev();d.control_key_active=false;return false}else{if(f.which===78&&d.control_key_active){d.select_next();d.control_key_active=false;return false}else{if(f.which===76&&d.control_key_active){d.cell_toggle_line_numbers();d.control_key_active=false;return false}else{if(f.which===72&&d.control_key_active){d.toggle_keyboard_shortcuts();d.control_key_active=false;return false}else{if(d.control_key_active){d.control_key_active=false;return true}}}}}}}}}}}}}}}}}}return true});this.element.bind("collapse_pager",function(){var f=$("div#main_app").height();var g=$("div#pager_splitter").outerHeight(true);var e=f-g;d.element.animate({height:e+"px"},"fast")});this.element.bind("expand_pager",function(){var g=$("div#main_app").height();var h=$("div#pager_splitter").outerHeight(true);var e=$("div#pager").outerHeight(true);var f=g-e-h;d.element.animate({height:f+"px"},"fast")});this.element.bind("collapse_left_panel",function(){var e=$("div#left_panel_splitter").outerWidth(true);var f=e;$("div#notebook_panel").animate({marginLeft:f+"px"},"fast")});this.element.bind("expand_left_panel",function(){var e=$("div#left_panel_splitter").outerWidth(true);var f=b.left_panel.width;var g=e+f;$("div#notebook_panel").animate({marginLeft:g+"px"},"fast")});$(window).bind("beforeunload",function(){if(d.dirty&&!d.read_only){return"You have unsaved changes that will be lost if you leave this page."}return null})};c.prototype.toggle_keyboard_shortcuts=function(){var g=this;if(this.shortcut_dialog){this.shortcut_dialog.dialog("close");this.shortcut_dialog=null;return}var f=$("<div/>");this.shortcut_dialog=f;var d=[{key:"Shift-Enter",help:"run cell"},{key:"Ctrl-Enter",help:"run cell in-place"},{key:"Ctrl-m d",help:"delete cell"},{key:"Ctrl-m a",help:"insert cell above"},{key:"Ctrl-m b",help:"insert cell below"},{key:"Ctrl-m t",help:"toggle output"},{key:"Ctrl-m l",help:"toggle line numbers"},{key:"Ctrl-m s",help:"save notebook"},{key:"Ctrl-m j",help:"move cell down"},{key:"Ctrl-m k",help:"move cell up"},{key:"Ctrl-m c",help:"code cell"},{key:"Ctrl-m m",help:"markdown cell"},{key:"Ctrl-m p",help:"select previous"},{key:"Ctrl-m n",help:"select next"},{key:"Ctrl-m h",help:"show keyboard shortcuts"}];for(var e=0;e<d.length;e++){f.append($("<div>").append($("<span/>").addClass("shortcut_key").html(d[e].key)).append($("<span/>").addClass("shortcut_descr").html(" : "+d[e].help)))}f.bind("dialogclose",function(h){g.shortcut_dialog=null});f.dialog({title:"Keyboard shortcuts"})};c.prototype.scroll_to_bottom=function(){this.element.animate({scrollTop:this.element.get(0).scrollHeight},0)};c.prototype.scroll_to_top=function(){this.element.animate({scrollTop:0},0)};c.prototype.cell_elements=function(){return this.element.children("div.cell")};c.prototype.ncells=function(d){return this.cell_elements().length};c.prototype.cells=function(){return this.cell_elements().toArray().map(function(d){return $(d).data("cell")})};c.prototype.find_cell_index=function(e){var d=null;this.cell_elements().filter(function(f){if($(this).data("cell")===e){d=f}});return d};c.prototype.index_or_selected=function(d){return d||this.selected_index()||0};c.prototype.select=function(d){if(d!==undefined&&d>=0&&d<this.ncells()){if(this.selected_index()!==null){this.selected_cell().unselect()}this.cells()[d].select()}return this};c.prototype.select_next=function(){var d=this.selected_index();if(d!==null&&d>=0&&(d+1)<this.ncells()){this.select(d+1)}return this};c.prototype.select_prev=function(){var d=this.selected_index();if(d!==null&&d>=0&&(d-1)<this.ncells()){this.select(d-1)}return this};c.prototype.selected_index=function(){var d=null;this.cell_elements().filter(function(e){if($(this).data("cell").selected===true){d=e}});return d};c.prototype.cell_for_msg=function(f){var e=this.msg_cell_map[f];var d=null;this.cell_elements().filter(function(g){cell=$(this).data("cell");if(cell.cell_id===e){d=cell}});return d};c.prototype.selected_cell=function(){return this.cell_elements().eq(this.selected_index()).data("cell")};c.prototype.delete_cell=function(d){var e=d||this.selected_index();if(e!==null&&e>=0&&e<this.ncells()){this.cell_elements().eq(e).remove();if(e===(this.ncells())){this.select(e-1)}else{this.select(e)}}this.dirty=true;return this};c.prototype.append_cell=function(d){this.element.find("div.end_space").before(d.element);this.dirty=true;return this};c.prototype.insert_cell_below=function(d,e){var f=this.ncells();if(f===0){this.append_cell(d);return this}if(e>=0&&e<f){this.cell_elements().eq(e).after(d.element)}this.dirty=true;return this};c.prototype.insert_cell_above=function(d,e){var f=this.ncells();if(f===0){this.append_cell(d);return this}if(e>=0&&e<f){this.cell_elements().eq(e).before(d.element)}this.dirty=true;return this};c.prototype.move_cell_up=function(f){var g=f||this.selected_index();if(g!==null&&g<this.ncells()&&g>0){var d=this.cell_elements().eq(g-1);var e=this.cell_elements().eq(g);if(d!==null&&e!==null){e.detach();d.before(e);this.select(g-1)}}this.dirty=true;return this};c.prototype.move_cell_down=function(f){var g=f||this.selected_index();if(g!==null&&g<(this.ncells()-1)&&g>=0){var d=this.cell_elements().eq(g+1);var e=this.cell_elements().eq(g);if(d!==null&&e!==null){e.detach();d.after(e);this.select(g+1)}}this.dirty=true;return this};c.prototype.sort_cells=function(){var f=this.ncells();var d=this.selected_index();var g;do{g=false;for(var e=1;e<f;e++){current=this.cell_elements().eq(e).data("cell");previous=this.cell_elements().eq(e-1).data("cell");if(previous.input_prompt_number>current.input_prompt_number){this.move_cell_up(e);g=true}}}while(g);this.select(d);return this};c.prototype.insert_code_cell_above=function(e){var f=this.index_or_selected(e);var d=new b.CodeCell(this);d.set_input_prompt();this.insert_cell_above(d,f);this.select(this.find_cell_index(d));return d};c.prototype.insert_code_cell_below=function(e){var f=this.index_or_selected(e);var d=new b.CodeCell(this);d.set_input_prompt();this.insert_cell_below(d,f);this.select(this.find_cell_index(d));return d};c.prototype.insert_html_cell_above=function(e){var f=this.index_or_selected(e);var d=new b.HTMLCell(this);d.config_mathjax();this.insert_cell_above(d,f);this.select(this.find_cell_index(d));return d};c.prototype.insert_html_cell_below=function(e){var f=this.index_or_selected(e);var d=new b.HTMLCell(this);d.config_mathjax();this.insert_cell_below(d,f);this.select(this.find_cell_index(d));return d};c.prototype.insert_markdown_cell_above=function(e){var f=this.index_or_selected(e);var d=new b.MarkdownCell(this);d.config_mathjax();this.insert_cell_above(d,f);this.select(this.find_cell_index(d));return d};c.prototype.insert_markdown_cell_below=function(e){var f=this.index_or_selected(e);var d=new b.MarkdownCell(this);d.config_mathjax();this.insert_cell_below(d,f);this.select(this.find_cell_index(d));return d};c.prototype.to_code=function(f){var h=this.index_or_selected(f);var g=this.cell_elements().eq(h);var d=g.data("cell");if(d instanceof b.HTMLCell||d instanceof b.MarkdownCell){this.insert_code_cell_below(h);var e=this.cells()[h+1];e.set_code(d.get_source());g.remove();e.select()}this.dirty=true};c.prototype.to_markdown=function(f){var h=this.index_or_selected(f);var g=this.cell_elements().eq(h);var d=g.data("cell");var e=null;if(d instanceof b.CodeCell){this.insert_markdown_cell_below(h);e=this.cells()[h+1];var j=d.get_code()}else{if(d instanceof b.HTMLCell){this.insert_markdown_cell_below(h);e=this.cells()[h+1];var j=d.get_source();if(j===d.placeholder){j=e.placeholder}}}if(e!==null){if(j===""){j=e.placeholder}e.set_source(j);g.remove();e.edit()}this.dirty=true};c.prototype.to_html=function(f){var h=this.index_or_selected(f);var g=this.cell_elements().eq(h);var d=g.data("cell");var e=null;if(d instanceof b.CodeCell){this.insert_html_cell_below(h);e=this.cells()[h+1];var j=d.get_code()}else{if(d instanceof b.MarkdownCell){this.insert_html_cell_below(h);e=this.cells()[h+1];var j=d.get_source();if(j===d.placeholder){j=e.placeholder}}}if(e!==null){if(j===""){j=e.placeholder}e.set_source(j);g.remove();e.edit()}this.dirty=true};c.prototype.collapse=function(d){var e=this.index_or_selected(d);this.cells()[e].collapse();this.dirty=true};c.prototype.expand=function(d){var e=this.index_or_selected(d);this.cells()[e].expand();this.dirty=true};c.prototype.toggle_output=function(d){var e=this.index_or_selected(d);this.cells()[e].toggle_output();this.dirty=true};c.prototype.set_timebeforetooltip=function(d){console.log("change time before tooltip to : "+d);this.time_before_tooltip=d};c.prototype.set_tooltipontab=function(d){console.log("change tooltip on tab to : "+d);this.tooltip_on_tab=d};c.prototype.set_smartcompleter=function(d){console.log("Smart completion (kwargs first) changed to  to : "+d);this.smart_completer=d};c.prototype.set_autoindent=function(f){var d=this.cells();len=d.length;for(var e=0;e<len;e++){d[e].set_autoindent(f)}};c.prototype.clear_all_output=function(){var f=this.ncells();var d=this.cells();for(var e=0;e<f;e++){if(d[e] instanceof b.CodeCell){d[e].clear_output(true,true,true)}}this.dirty=true};c.prototype.cell_toggle_line_numbers=function(){this.selected_cell().toggle_line_numbers()};c.prototype.handle_output=function(d,g,f){var e={};e.output_type=g;e.content=f;e.javascript=true;e.prompt_number=this.next_prompt_number;d.append_output(e);this.dirty=true};c.prototype.execute=function(d){};c.prototype.execute_selected_cell=function(f){default_options={terminal:false,add_new:true};$.extend(default_options,f);var h=this;var d=h.selected_cell();var i=h.find_cell_index(d);if(d instanceof b.CodeCell){d.clear_output(true,true,true);d.element.addClass("running");var g=d.get_code();var e=a.uuid();h.msg_cell_map[e]=d.cell_id;this.handle_output(d,"jsout",g)}else{if(d instanceof b.HTMLCell){d.render()}}if(default_options.terminal){d.select_all()}else{if((i===(h.ncells()-1))&&default_options.add_new){h.insert_code_cell_below();h.scroll_to_bottom()}else{h.select(i+1)}}this.next_prompt_number++;this.dirty=true};c.prototype.execute_all_cells=function(){var e=this.ncells();for(var d=0;d<e;d++){this.select(d);this.execute_selected_cell({add_new:false})}this.scroll_to_bottom()};c.prototype.request_tool_tip=function(d,e){};c.prototype.complete_cell=function(d,f,e){};c.prototype.fromJSON=function(h){var g=this.ncells();var f;for(f=0;f<g;f++){this.delete_cell(0)}this.metadata=h.metadata;var k=h.worksheets[0];if(k!==undefined){var d=k.cells;g=d.length;var j=null;var e=null;for(f=0;f<g;f++){j=d[f];if(j.cell_type=="code"){e=this.insert_code_cell_below();e.fromJSON(j)}else{if(j.cell_type==="html"){e=this.insert_html_cell_below();e.fromJSON(j)}else{if(j.cell_type==="markdown"){e=this.insert_markdown_cell_below();e.fromJSON(j)}}}}}};c.prototype.toJSON=function(){var d=this.cells();var f=d.length;cell_array=new Array(f);for(var e=0;e<f;e++){cell_array[e]=d[e].toJSON()}data={worksheets:[{cells:cell_array}],metadata:this.metadata};return data};c.prototype.save_notebook=function(){};c.prototype.notebook_saved=function(e,d,f){};c.prototype.notebook_save_failed=function(f,d,e){};c.prototype.load_notebook=function(d){this.insert_code_cell_below();this.notebook_loaded();d()};c.prototype.notebook_loaded=function(){if(this.ncells()===0){this.insert_code_cell_below()}this.dirty=false;setTimeout(function(){b.notebook.select(0);b.notebook.scroll_to_top()},50)};b.Notebook=c;return b}(skanti));